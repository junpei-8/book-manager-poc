# 開発者向け資料

<br />

## システムアーキテクチャ

### Client

| カテゴリ         | 技術          |
| ---------------- | ------------- |
| フレームワーク   | Astro + React |
| スタイリング     | Tailwind CSS  |
| UIコンポーネント | shadcn/ui     |
| 状態管理         | Nanostores    |
| 認証             | Better Auth   |

### Server

| カテゴリ                 | 技術        |
| ------------------------ | ----------- |
| フレームワーク           | Hono        |
| データベースクライアント | Drizzle     |
| API Format               | RESTful API |
| 認証                     | Better Auth |

### Database

| カテゴリ           | 技術                 |
| ------------------ | -------------------- |
| データベース       | LibSQL               |
| データベースモデル | Drizzle              |
| マイグレーション   | Drizzle Kit          |
| データベースツール | Drizzle Kit (studio) |

<br />

## 開発環境

### 必要条件

- Git
- Moonrepo
- Prototools

### 開発ツール

- エディタ (VSCode 推奨)

<br />

## プロジェクト構造

```
.
├── .changeset/         # バージョン管理
├── .github/            # GitHub 設定
├── .moon/              # Moonrepo 設定
├── .vscode/            # VSCode 設定
├── @apps/              # アプリケーション
│   └── client/         # クライアントアプリケーション
│   └── database/       # データベースアプリケーション
│   └── server/         # サーバーアプリケーション
├── @libs/              # アプリケーション共有ライブラリ
│   └── shadcn/         # shadcn/ui のライブラリ
├── @packages/          # 共有パッケージ（汎用）
│   ├── codebase/       # コードベース設定
│   │   ├── eslint/     # ESLint 設定
│   │   └── prettier/   # Prettier 設定
│   └── config/         # 設定パッケージ
│       └── typescript/ # TypeScript 設定
├── _docs/              # ドキュメント
└── package.json        # プロジェクト設定
```

<br />

## コーディング規約

### 命名規則

- コンポーネント: PascalCase
- 変数: camelCase
- 定数: UPPER_SNAKE_CASE
- 関数: camelCase
- クラス: PascalCase
- 型定義: PascalCase
- ファイル名: kebab-case
- ディレクトリ名: kebab-case

### コンポーネント設計

- コンポーネントの責務の明確化
- コンポーネントの分割基準
  - 機能の独立性
  - 再利用性
  - テスト容易性

### 状態管理

- グローバル状態: Nanostores
- ローカル状態: React useState

<br />

## テスト戦略

### 単体テスト

- フレームワーク: Vitest
- カバレッジ目標: 80%以上

### E2Eテスト

- フレームワーク: Playwright
- テスト対象
  - ユーザーフロー
  - クリティカルパス
  - エッジケース

<br />

## デプロイメント

### CI/CD

- GitHub Actions
  - CI
    - Lint check
    - ビルド
    - テスト
  - CD
    - Cloudflare workers
    - Turso

### 環境

| 環境 | 説明             | ブランチ    |
| ---- | ---------------- | ----------- |
| dev  | 開発環境         | development |
| stg  | ステージング環境 | staging     |
| prd  | 本番環境         | production  |

### デプロイフロー

1. 開発環境へのデプロイ
   - feature/... から development ブランチへのプッシュで自動デプロイ
2. ステージング環境へのデプロイ
   - development ブランチから staging ブランチへのマージで自動デプロイ
3. 本番環境へのデプロイ
   - staging ブランチから production ブランチへのマージで自動デプロイ

<br />

## パフォーマンス最適化

### 最適化目標

- Lighthouse パフォーマンススコア: 80点以上
- Cumulative Layout Shift: なし
- Core Web Vitals の基準をクリア

### 最適化戦略

- コード分割
  - ルートベースの分割
  - コンポーネントの遅延ロード
- 画像最適化
  - WebP形式の使用
  - 適切なサイズの提供
- キャッシュ戦略
  - ブラウザキャッシュ
  - CDNキャッシュ
- バンドルサイズの最適化
  - ツリーシェイキング
  - 未使用コードの削除

<br />

## セキュリティ

### 実装ガイドライン

- XSS対策
  - 入力値のサニタイズ
  - CSPの設定
- CSRF対策
  - Cookie の設定
- 入力値のバリデーション
  - クライアントサイドでのUX向上のためのバリデーション
  - サーバーサイドでの厳密なバリデーション
- セキュアな認証・認可
  - OAuth を用いた認証
  - 安全な Cache の実装

### セキュリティチェック

- 依存パッケージの脆弱性スキャン
  - 週次スキャン
  - 自動アップデート
- セキュリティ監査
  - 定期的なコードレビュー
  - 外部セキュリティ監査
- ペネトレーションテスト
  - 四半期ごとの実施
  - 脆弱性レポートの管理

<br />

## モニタリングとロギング

### モニタリング項目

- エラー率
  - アプリケーションエラー
  - API エラー
- レスポンスタイム
  - API 応答時間
  - ページロード時間
- ユーザーセッション
  - アクティブユーザー数
  - セッション時間
- リソース使用率
  - CPU使用率
  - メモリ使用率
  - データベース接続数

### ログ管理

- エラーログ
  - スタックトレース
  - エラーコンテキスト
- アクセスログ
  - リクエスト情報
  - レスポンス情報
- パフォーマンスログ
  - 処理時間
  - リソース使用量
- セキュリティログ
  - 認証試行
  - 不正アクセス

<br />

## バックアップと復旧

### バックアップ戦略

- データベースの定期バックアップ
  - 週次バックアップ
  - 月次バックアップ
- 設定ファイルのバージョン管理
  - Gitでの管理
  - 変更履歴の保持
- 障害復旧手順の整備
  - 手順書の作成
  - 定期的な訓練

### 障害対応

- インシデント対応フロー
  - 検知
  - 分析
  - 対応
  - 復旧
  - 報告
